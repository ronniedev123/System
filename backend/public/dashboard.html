<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Church Dashboard</title>
<link rel="stylesheet" href="css/styles.css">
<style>
/* Layout */
body {
    font-family: "Inter", system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
}

.page {
    max-width: 1200px;
    margin: 30px auto;
    padding: 20px;
}

/* Top Bar */
.topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    <div id="welcomeText" style="font-size:14px; color:var(--muted);"></div>

}

.topbar h1 {
  font-size: 28px;
  font-weight: 700;
}

/* Buttons */
.btn {
  padding: 10px 18px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 600;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-danger {
  background: var(--danger);
  color: white;
}

/* Stats */
.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  padding: 22px;
  border-radius: 16px;
  text-align: center;
}

.stat h3 {
  font-size: 32px;
  font-weight: 700;
}

.stat p {
  opacity: 0.85;
}

/* Dashboard Cards */
.dashboard {
  background: var(--card);
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.05);
}

.dashboard h2 {
  margin-bottom: 20px;
}

.actions {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
}

.action {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 20px;
  text-align: center;
  transition: all 0.2s ease;
}

.action:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.08);
}

.action a {
    text-decoration: none;
    font-weight: 600;
    color: var(--primary);
}

</style>
</head>
<body>
<div class="page">

    <!-- Top Bar -->
    <div class="topbar">
        <button class="btn btn-primary" onclick="location.href='index.html'">
        â† Back
        </button>

        <h1>â›ª Church Dashboard</h1>
        <div id="welcomeText" style="font-size:14px; color:var(--muted);"></div>
        <button id="logoutBtn" class="btn btn-danger">Logout</button>
    </div>

    <!-- Stats -->
    <div class="stats" id="stats" style="display:none;">
        <div class="stat">
        <h3 id="totalMembers">0</h3>
        <p>Total Members</p>
        </div>
        <div class="stat">
        <h3 id="upcomingEvents">0</h3>
        <p>Upcoming Events</p>
        </div>
        <div class="stat">
        <h3 id="totalDonations">0</h3>
        <p>Total Donations</p>
        </div>
        <div class="stat">
        <h3 id="todayAttendance">0</h3>
        <p>Today's Attendance</p>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="dashboard" style="display:none;">
        <h2>Admin Panel</h2>
        <div class="actions">
        <div class="action"><a href="members.html">ğŸ‘¥ Manage Members</a></div>
        <div class="action"><a href="users.html">ğŸ§‘â€ğŸ’¼ Manage Users</a></div>
        <div class="action"><a href="events.html">ğŸ“… Events</a></div>
        <div class="action"><a href="announcements.html">ğŸ“¢ Announcements</a></div>
        <div class="action"><a href="attendance.html">âœ… Attendance</a></div>
        <div class="action"><a href="graphs.html">ğŸ“Š Reports</a></div>
        <div class="action"><a href="donations.html">ğŸ’° Donations</a></div>
        </div>
    </div>

    <!-- User Dashboard -->
    <div id="userDashboard" class="dashboard" style="display:none;">
        <h2>User Panel</h2>
        <div class="actions">
        <div class="action"><a href="members.html">ğŸ‘¥ Members</a></div>
        <div class="action"><a href="events.html">ğŸ“… Events</a></div>
        <div class="action"><a href="donations.html">ğŸ’° Donate</a></div>
        <div class="action"><a href="attendance.html">âœ… Attendance</a></div>
        <div class="action"><a href="announcements.html">ğŸ“¢ Announcements</a></div>
        <div class="action"><a href="graphs.html">ğŸ“Š Reports</a></div>
        </div>
    </div>
</div>
<script>
const token = localStorage.getItem('token');
if(!token){
    window.location.href = "index.html";
} else {
    try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        const role = payload.role;

        // Load dashboards based on role
        if(role === 'admin'){
            document.getElementById('adminDashboard').style.display = 'block';
        } else {
            document.getElementById('userDashboard').style.display = 'block';
        }

        // Show quick stats
        document.getElementById('stats').style.display = 'flex';

        // Fetch stats from backend
        fetch("http://localhost:3000/api/members/stats", {
            headers: { "Authorization": `Bearer ${token}` }
        })
        .then(res => res.json())
        .then(data => {
            document.getElementById('totalMembers').innerText = data.totalMembers;
            document.getElementById('upcomingEvents').innerText = data.upcomingEvents;
            document.getElementById('totalDonations').innerText = "$" + data.totalDonations;
            document.getElementById('todayAttendance').innerText = data.todayAttendance;
        })
        .catch(err => console.error("Error fetching stats:", err));

    } catch(err){
        console.error("Invalid token", err);
        localStorage.removeItem('token');
        window.location.href = "index.html";
    }
}

document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('token');
    window.location.href = "index.html";
});
</script>
</body>
</html>
